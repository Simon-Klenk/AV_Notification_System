<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>AV Benachrichtigungssystem – Status</title><style>body{font-family:sans-serif;background-color:#f9fafb;min-height:100vh;margin:0;display:flex;flex-direction:column;font-weight:300}nav{background-color:#2d2d2d;padding:1rem;box-shadow:0 12px 30px -5px rgba(0,0,0,.25)}.nav-list{max-width:64rem;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:1.5rem}.nav-link{color:#d1d5db;font-size:1.125rem;font-weight:400;padding:.5rem;border-radius:.375rem;text-decoration:none;white-space:nowrap;transition:color .2s,background-color .2s}.nav-link:hover{color:#fff;background-color:#4b5563}.nav-link.active{color:#fff;background-color:#4b5563}main{flex-grow:1;padding:2rem 1rem;display:flex;justify-content:center}.message-box{background-color:#fff;padding:1.5rem 1rem;border-radius:.75rem;box-shadow:0 10px 15px -3px rgba(0,0,0,.1);width:80%;max-width:36rem}.title{font-size:1.5rem;font-weight:700;color:#4b5563;margin-bottom:1rem;text-align:center}.messages-list-container{display:flex;flex-direction:column;gap:1rem}.message-item{display:flex;flex-direction:column;background-color:#fff;border-radius:.75rem;box-shadow:0 6px 10px -2px rgba(0,0,0,.08);padding:.75rem 1rem;gap:.3rem}.message-content{display:flex;flex-direction:column;gap:.2rem}.type-badge,.status-label,.type-badge.status-label{border-radius:9999px;display:inline-block;width:150px;text-align:center;margin-top:.15rem;padding:.2rem .6rem;font-size:.7rem;font-weight:500;color:#fff}.type-badge{background-color:#595959}.label-wait{background-color:#f97316}.label-accept{background-color:#10B981}.label-reject{background-color:#ef4444}.label-show{background-color:#3b82f6}.label-display{background-color:#8b5cf6}.timestamp{color:#6b7280;font-size:.8rem;margin-top:.1rem}.placeholder{color:#6b7280;text-align:center}@media (max-width:640px){.nav-list{flex-direction:column;gap:.5rem}.nav-link{width:90%;text-align:center}}</style></head><body><nav><div class="nav-list"><a href="/?page=pickup" class="nav-link">Kind abholen</a><a href="/?page=parking" class="nav-link">Fahrzeug umparken</a><a href="/?page=emergency" class="nav-link">Notfall - Hilfe anfordern</a><a href="/?page=status" class="nav-link active">Status</a></div></nav><main><div class="message-box"><h2 class="title">Gesendete Nachrichten</h2><div id="messagesList" class="messages-list-container"><p id="loadingIndicator" class="placeholder">Nachrichten werden geladen...</p></div></div></main><script>async function fetchMessages(){const listContainer=document.getElementById('messagesList');let loadingIndicator=document.getElementById('loadingIndicator');if(!loadingIndicator){loadingIndicator=document.createElement('p');loadingIndicator.id='loadingIndicator';loadingIndicator.className='placeholder';listContainer.appendChild(loadingIndicator)}listContainer.innerHTML='';listContainer.appendChild(loadingIndicator);loadingIndicator.textContent="Nachrichten werden geladen...";loadingIndicator.classList.remove('hidden');try{const response=await fetch('/messages');const data=await response.json();const messages=(data.messages||[]).slice().reverse();if(messages.length===0){loadingIndicator.textContent='Bisher wurden keine Nachrichten gesendet.';return}listContainer.innerHTML='';messages.forEach((m)=>{const type=m.type||"PICKUP";const state=m.state||"wait";const timestamp=m.timestamp||"";const textMsg=m.value||"";let typeLabel="Abholnachricht";if(type==="EMERGENCY")typeLabel="Notfall – Check-In";else if(type==="PARKING")typeLabel="Umpark-Nachricht";let stateLabel="Wartet auf Anzeige durch AV";let labelClass="label-wait";if(state==="accept"||state==="accepted"){stateLabel="Wird aktuell angezeigt";labelClass="label-accept"}else if(state==="reject"||state==="rejected"){stateLabel="Wurde abgelehnt";labelClass="label-reject"}else if(state==="show"){stateLabel="Wurde bereits angezeigt";labelClass="label-show"}const html=`<div class="message-item"><div class="message-content"><span class="type-badge">${typeLabel}</span><p><strong>${textMsg}</strong></p><span class="type-badge ${labelClass}">${stateLabel}</span><p class="timestamp">Gesendet am: ${timestamp}</p></div></div>`;listContainer.insertAdjacentHTML('beforeend',html)})}catch(err){loadingIndicator.textContent='❌ Fehler beim Laden der Nachrichten.';console.error('Fehler beim Laden der Nachrichten:',err)}}window.onload=function(){fetchMessages();setInterval(fetchMessages,5000)}</script></body></html>